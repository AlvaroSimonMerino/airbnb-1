---
title: "EDA Airbnb"
author: "Antonio Fernández Cáceres"
date: "18/11/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Cargar Librerías

```{r}
library(dplyr)
library(ggplot2)
library(stringr)
library(readr)
library(batman)
```

```{r loadData}
data <- read.csv(file = '../00_DatosOriginales/listings.csv', header = TRUE)
```

```{r typeConversion}
data$host_since <- as.Date(data$host_since)
data$host_is_superhost <- to_logical(data$host_is_superhost)
data$price<-parse_number(data$price)
```

### 4. Análisis univariante

#### price

```{r precios}


ggplot(data, aes(x=price, y=..density..)) + geom_histogram(binwidth = 10) + geom_density(alpha = .2, fill="red")

ggplot(data, aes(x=price, y=..density..)) + geom_histogram(binwidth = 10) + geom_density(alpha = .2, fill="red") + xlim(c(0,500))

ggplot(data, aes(y=price)) + geom_boxplot() + scale_y_continuous(trans='log10')

quantile(data$price)
```


La variable $price$, la cual queremos predecir, en general se concentra entre los 37 y los 105€, y en general el número de Airbnb decrece con el precio.

#### neighbourhood_group_cleansed

```{r distritos}
cuentaDistritos <- data %>%
  group_by(neighbourhood_group_cleansed) %>%
  summarise(count = n()) %>%
  arrange(-count)

ggplot(data, aes(x=neighbourhood_group_cleansed)) + geom_histogram(stat='count')
```

Atendiendo al distrito, el que más AirBnb tiene, por mucho, es el Centro.


#### room_type

```{r tipos}
ggplot(data, aes(x=room_type)) + geom_histogram(stat='count')

cuentaTipos <- data %>%
  group_by(room_type) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaTipos
```

#### accommodates

```{r accommodates}
ggplot(data, aes(x=accommodates)) + geom_histogram(stat='count')

cuentaAccommodates <- data %>%
  group_by(accommodates) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaAccommodates

```

Aproximadamente un tercio de las propiedades son para 2 personas, y la gran mayoría son para 6 o menos.


#### bedrooms

```{r bedrooms}
ggplot(data, aes(x=bedrooms)) + geom_histogram(stat='count')

cuentaBedrooms <- data %>%
  group_by(bedrooms) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaBedrooms

```

Dos tercios de las propiedades tienen 1 dormitorio, y el resto menos. Hay 1434 datos faltantes.


#### beds

```{r beds}
ggplot(data, aes(x=beds)) + geom_histogram(stat='count')

cuentaBeds <- data %>%
  group_by(beds) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaBeds

```

La mayoría de las propiedades tienen entre 1 y 4 camas.


#### minimum_nights

```{r minNights}
ggplot(data, aes(x=minimum_nights)) + geom_histogram(binwidth = 1)  + scale_y_continuous(trans='log10')

cuentaMinNights <- data %>%
  group_by(minimum_nights) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaMinNights

```

#### minimum_nights_avg_ntm

```{r minNightsAvg}
ggplot(data, aes(x=minimum_nights_avg_ntm)) + geom_histogram(binwidth = 1)  + scale_y_continuous(trans='log10')

cuentaMinNightsAvg <- data %>%
  group_by(minimum_nights_avg_ntm) %>%
  summarise(count = n()) %>%
  arrange(-count)

cuentaMinNightsAvg

```

#### maximum_nights_avg_ntm

```{r maxNightsAvg}
ggplot(data, aes(x=maximum_nights_avg_ntm)) + geom_histogram(binwidth = 5)  + scale_y_continuous(trans='log10') + xlim(c(0,2000))
```


#### host_since

```{r host_since}
ggplot(data, aes(x=host_since)) + geom_histogram(binwidth = 30)

```


#### host_is_superhost

```{r host_is_superhost}
ggplot(data, aes(x=host_is_superhost)) + geom_histogram(stat="count")
```

#### availability_365

```{r availability_365}
ggplot(data, aes(x=availability_365)) + geom_histogram(stat="count")
```
