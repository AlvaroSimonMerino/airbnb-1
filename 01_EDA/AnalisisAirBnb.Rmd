---
title: "FAD_DataAnalysis_practica"
author: "Alvaro Simón Merino, Antonio Fernández Cáceres"
date: "13/11/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Cargar Librerías

```{r}
library(dplyr)
library(ggplot2)
library(stringr)
library(readr)
```


## R Markdown

```{r loadData}
RawData <- read.csv(file = '../00_DatosOriginales/listings.csv', header = TRUE)
#summary(RawData)
data <- RawData %>%
  select(id, host_id, host_since, host_is_superhost, neighbourhood_group_cleansed, property_type, room_type, accommodates, bedrooms, price, minimum_nights, minimum_nights_avg_ntm, maximum_nights_avg_ntm, availability_365, review_scores_rating, review_scores_accuracy, review_scores_cleanliness, review_scores_checkin, review_scores_communication, review_scores_location, review_scores_value, reviews_per_month)
summary(data)
ncol(data)
str(data)
```


A continuación convertiremos los tipos que no sean correctos:

```{r typeConversion}
data$price<-parse_number(data$price) #Convertimos los precios en números con readr
# data$host_is_superhost %>%str_replace_all(c('f' = "0", "t"="1"))
class(data$host_is_superhost) = "Logical" #Convertimos esta variable a lógica. TODO Verificar si esta conversión es buena
```

```{r cuentaAirbnbs}
cuentaABs <- data %>%
  group_by(neighbourhood_group_cleansed) %>%
  summarise(count = n()) %>%
  arrange(-count) %>%
  rename(cuenta = count)

ggplot(cuentaABs, aes(x=reorder(neighbourhood_group_cleansed, -cuenta), y=cuenta)) + geom_bar(stat='identity')
```
Este gráfico revela la inmensa cantidad de AirBnbs que hay en el centro frente al resto de Madrid.


```{r preciosGenerales}
ggplot(data, aes(x= reorder(neighbourhood_group_cleansed, -price), y= price)) +
  geom_bar(stat = "summary", fun = "mean")
```

Esta gráfica no es clara, ya que están mezclados pisos y habitaciones.


```{r preciosPisos}

dataPisos <- data[data$room_type == "Entire home/apt",]
ggplot(dataPisos, aes(x= reorder(neighbourhood_group_cleansed, -price), y= price)) +
  geom_bar(stat = "summary", fun = "mean")
```

```{r preciosHabitaciones}

dataHabs <- data[data$room_type == "Private room",]
ggplot(dataHabs, aes(x= reorder(neighbourhood_group_cleansed, -price), y= price)) +
  geom_bar(stat = "summary", fun = "mean")
```



```{r preciosCanillejas}

dataCanillejasPisos <- data[data$neighbourhood_group_cleansed == "San Blas - Canillejas" & data$room_type == "Entire home/apt",]
dataCanillejasHabs <- data[data$neighbourhood_group_cleansed == "San Blas - Canillejas" & data$room_type == "Private room",]
dataCanillejasPisos$price
dataCanillejasHabs$price
```

Habrá que explorar por qué los pisos son tan caros en Canillejas. ¿Habitaciones para varias personas?


```{r preciosVillaverde}

dataVillaverdePisos <- data[data$neighbourhood_group_cleansed == "Villaverde" & data$room_type == "Entire home/apt",]
dataVillaverdeHabs <- data[data$neighbourhood_group_cleansed == "Villaverde" & data$room_type == "Private room",]
dataVillaverdePisos$price
dataVillaverdeHabs$price
```

Los pisos de Villaverde o son outliers (error o casa de lujo) o son pisos francos XD

```
TODO:
explorar por qué los pisos son tan caros en Canillejas. ¿Habitaciones para varias personas?
Los pisos de Villaverde o son outliers (error o casa de lujo) o son pisos francos XD
```